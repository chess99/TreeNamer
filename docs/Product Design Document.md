# TreeNamer 产品设计文档

## 一、核心目标

提供**零学习成本的目录树可视化重命名工具**，通过类代码编辑器的交互逻辑，让用户直接修改目录结构文本并安全同步到文件系统。

## 二、用户场景与需求

| 用户类型           | 痛点场景                                                                 | 需求优先级 |
|--------------------|--------------------------------------------------------------------------|------------|
| 开发者             | 批量重构项目文件结构时，传统工具无法直观对比目录层级变化                 | ⭐⭐⭐⭐⭐     |
| 数字资产管理者     | 处理数千个媒体文件时，需要结合正则表达式和可视化编辑快速调整命名规则     | ⭐⭐⭐⭐      |
| 普通用户           | 对命令行不熟悉，但希望安全地批量重命名嵌套文件夹中的文件                 | ⭐⭐⭐       |

## 三、交互设计

### 1. 主界面布局（分屏模式）

```plaintext
+-----------------------------------------------+
| [Open Folder按钮]  [帮助图标] [设置图标]       |
+-----------------------+-----------------------+
| 原始目录树 (只读)      | 编辑后目录树 (可修改)  |
|                       |                       |
| (类VSCode编辑器样式)   | (实时Diff高亮)         |
+-----------------------+-----------------------+
| [撤销/重做] [应用修改] [导出为脚本]            |
+-----------------------------------------------+
```

### 2. 关键交互流程

#### 场景：拖拽文件夹加载目录树

1. **触发方式**  
   - 拖拽文件夹至窗口任意区域
   - 点击顶部导航栏的`Open Folder`按钮
2. **反馈机制**  
   - 拖拽时显示半透明覆盖层（含`松开以加载`提示）
   - 加载大型目录时显示进度条和文件计数

#### 场景：多光标编辑文件名

1. **操作方式**  
   - `Ctrl+Click`添加新光标
   - `Alt+鼠标拖动`创建纵向多光标
2. **视觉反馈**  
   - 当前光标所在行显示浅蓝色背景
   - 修改后的文本行右侧显示绿色`+`或红色`-`标记

#### 场景：正则替换

1. **调用路径**  
   - 快捷键 `Ctrl+R` 打开替换面板
   - 右键菜单选择`批量替换`
2. **面板设计**  

   ```plaintext
   +------------------------------+
   | [正则表达式输入框]            |
   | [替换为输入框]                |
   +----------------+-------------+
   | [测试] [全部替换] [取消]      |
   +------------------------------+
   ```

   - 实时显示匹配结果计数（如`匹配到 12 处`）

## 四、核心功能定义

### 1. 目录树渲染规则

- **缩进表示层级**：每级子目录/文件缩进2个空格
- **连接符规范**：

  ```plaintext
  folder/
  ├── file1.txt    # 中间节点
  └── subdir/      # 末节点
      └── file2.txt
  ```

- **特殊标识**：
  - 红色斜体：已被删除的条目（仅Diff模式显示）
  - 绿色背景：新增条目

### 2. 差异对比逻辑

| 变更类型 | 处理规则                                                                 |
|----------|--------------------------------------------------------------------------|
| 重命名   | 高亮修改前后的文件名（如`doc.txt` → `document.txt`）                     |
| 移动路径 | 在原始位置标记为删除，在新位置标记为新增                                 |
| 结构变更 | 折叠/展开的目录节点变化时，自动展开受影响的部分                          |

### 3. 安全机制

- **三级确认流程**：
  1. 点击`应用修改`时弹出摘要弹窗（显示影响文件数）
  2. 强制输入"CONFIRM"确认执行
  3. 自动创建备份（路径：`原目录/.treenamer_backup/时间戳/`）

## 五、异常处理设计

| 异常场景               | 用户提示方式                          | 自动处理策略                     |
|------------------------|---------------------------------------|----------------------------------|
| 目录被其他程序占用     | 红色Toast提示具体文件路径            | 跳过被占用的文件，继续其他操作   |
| 权限不足               | 弹窗引导用户以管理员身份重新启动      | 无                               |
| 编辑后路径存在冲突     | 在Diff面板用黄色波浪线标注冲突行      | 阻止应用操作直到冲突解决         |

## 六、无障碍设计

- **键盘导航**：支持全功能键盘操作（Tab切换面板，方向键浏览目录树）
- **屏幕阅读器**：为可视化元素添加ARIA标签
- **高对比度模式**：提供暗色/高对比度主题选项
